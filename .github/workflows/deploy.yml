name: ğŸš€ Deploy ke Railway

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    env:
      RAILWAY_TOKEN: ${{ secrets.RAILWAY_TOKEN }}
      PROJECT_ID: 2bc0aa0e-0e39-441d-8f71-6b5e18fa94c9
      SERVICE_NAME: ai-assistant-bot

    steps:
      - name: ğŸ”„ Checkout kode
        uses: actions/checkout@v3

      - name: âš™ï¸ Install Railway CLI
        run: npm install -g railway

      - name: ğŸ”— Link project Railway
        run: railway link --project "$PROJECT_ID"

      - name: ğŸ”— Link service
        run: railway service link "$SERVICE_NAME"

      - name: ğŸš€ Deploy ke Railway
        run: |
          echo "====>>> Memulai deployment..."
          echo "ğŸš€ Men-deploy service: $SERVICE_NAME"

          if railway up --service "$SERVICE_NAME" --detach -v; then
            echo "âœ… Deployment berhasil"
            echo "ğŸ“Š Status terakhir:"
            railway status
          else
            echo "âŒ Deployment gagal!"
            echo "ğŸ“„ Log error terakhir:"
            railway logs --limit 10
            exit 1
          fi

