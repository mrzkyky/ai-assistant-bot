name: 🚀 Deploy ke Railway

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    env:
      RAILWAY_TOKEN: ${{ secrets.RAILWAY_TOKEN }}
      PROJECT_ID: 2bc0aa0e-0e39-441d-8f71-6b5e18fa94c9
      SERVICE_NAME: ai-assistant-bot

    steps:
      - name: 🔄 Checkout kode
        uses: actions/checkout@v3

      - name: ⚙️ Install Railway CLI
        run: npm install -g railway

      - name: 🔗 Link project Railway
        run: railway link --project "$PROJECT_ID"

      - name: 🔗 Link service
        run: railway service link "$SERVICE_NAME"

      - name: 🚀 Deploy ke Railway
        run: |
          echo "====>>> Memulai deployment..."
          echo "🚀 Men-deploy service: $SERVICE_NAME"

          if railway up --service "$SERVICE_NAME" --detach -v; then
            echo "✅ Deployment berhasil"
            echo "📊 Status terakhir:"
            railway status
          else
            echo "❌ Deployment gagal!"
            echo "📄 Log error terakhir:"
            railway logs --limit 10
            exit 1
          fi

